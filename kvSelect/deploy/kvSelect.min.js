async function kvSelect(e){if(!(e instanceof Element))return void document.querySelectorAll("select.kvSelect").forEach((e=>kvSelect(e)));const t=document.createElement("span");function n(e,t=!1){const n=e.previousElementSibling.value;let l=[];[...e.options].forEach((e=>l.push({selected:e.hasAttribute("selected")||!1,value:e.value,text:e.innerText}))),t&&(l=l.sort(((e,t)=>e.text<t.text?-1:1)));const s=e.scrollLeft,i=e.scrollTop;e.innerHTML="",l.forEach((t=>{let l="*"===t.text||t.selected||""===n||-1!=t.text.toLowerCase().indexOf(n);e.insertAdjacentHTML("beforeend",`<option value="${t.value||t.text}"${l?"":' style="display:none"'}${t.selected?" selected":""}>${t.text}</option>`)})),e.value="",setTimeout((()=>e.scroll(s,i)),0)}t.classList=e.classList,e.classList="",t.insertAdjacentHTML("afterbegin",`<input type="search" style="display:block;margin-bottom:1px" placeholder="${e.getAttribute("placeholder")}">`),e.insertAdjacentElement("beforebegin",t),t.insertAdjacentElement("beforeend",e),e.style.width=`${t.firstChild.getBoundingClientRect().width}px`,t.firstChild.addEventListener("input",(e=>{e.target.nextElementSibling.options[0].removeAttribute("selected"),n(e.target.nextElementSibling)})),n(e,!0),e.addEventListener("click",(t=>{const l=t.target;if(l.hasAttribute("selected")?l.removeAttribute("selected"):l.setAttribute("selected",""),"*"===l.innerText){const t=l.hasAttribute("selected");for(let n of e.options)"none"!==n.style.display&&(t?n.setAttribute("selected",""):n.removeAttribute("selected"))}else e.options[0].removeAttribute("selected");n(t.currentTarget)})),e.addEventListener("keydown",(e=>{const t=e.currentTarget;"Enter"===e.key?t.options[t.selectedIndex].click():"Delete"===e.key&&(t.previousElementSibling.value="")}))}window.addEventListener("load",kvSelect);