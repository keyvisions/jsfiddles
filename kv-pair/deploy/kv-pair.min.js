class kvPair extends HTMLElement{static observedAttributes=["src","pair","labels"];constructor(){super(),this.addEventListener("click",this.#e),this.addEventListener("keydown",this.#e),this.addEventListener("focusout",this.#e),this.addEventListener("focusin",this.#e),this.innerHTML=`<menu role="list" data-bit="0"></menu><menu role="list" data-bit="1"></menu><input type="hidden" name="${this.getAttribute("name")||"kv-pair"}">`,this.removeAttribute("name"),this.children[0].addEventListener("scroll",this.#e),this.children[0].addEventListener("scrollend",this.#e),this.children[1].addEventListener("scroll",this.#e),this.children[1].addEventListener("scrollend",this.#e)}async#t(e){return await fetch(e).then((e=>e.json())).then((e=>e)).catch((()=>["",""]))}async attributeChangedCallback(e,t,i){if(t==i)return;if("pair"==e)return this.setAttribute("pair","true"==i?"true":"false"),void(this.children[1].style.display="true"==i?"":"none");const s="["==i[0]?JSON.parse(i):await this.#t(i),n=(s[0]||"").split(","),l=(s[1]||"").split(","),r=Math.max(n.length,l.length);for(;n.length<r;)n.push("");for(;l.length<r;)l.push("");this.children[0].innerHTML=n.map((e=>`<div role="listitem" contenteditable>${e}</div>`)).join(""),this.children[1].innerHTML=l.map((e=>`<div role="listitem" contenteditable>${e}</div>`)).join(""),s[1]||(this.children[1].style.display="none"),this.#i()}#e(e){if(e.key){if(-1==["Enter",",","Tab","ArrowDown","ArrowUp"].indexOf(e.key))return;e.preventDefault()}if("focusin"==e.type||"focusout"==e.type&&null==e.relatedTarget)return void this.querySelectorAll(".selected").forEach((e=>e.className=""));let t=e.relatedTarget||e.target;"scroll"!=e.type&&"scrollend"!=e.type&&"MENU"==t.tagName&&(t=t.lastChild,t.focus());const i=t.closest("menu")||this.querySelector("menu"),s=this.closest("kv-pair").querySelector(`menu[data-bit="${"0"==i.dataset.bit?"1":"0"}"]`);if("scroll"==e.type||"scrollend"==e.type)return void(s.scrollTop=i.scrollTop);this.querySelectorAll(".selected").forEach((e=>e.className=""));let n=0;for(;t.previousElementSibling;t=t.previousElementSibling,++n);switch(e.key){case"ArrowDown":n=n<i.children.length-1?n+2:1;case"ArrowUp":n=n>0?n-1:i.children.length-1,this.#s(i.children[n]),s.children[n].className="selected";break;case"Tab":this.#s(s.children[n]),s.children[n].className="",i.children[n].className="selected";break;case"Enter":i.insertAdjacentHTML("beforeend",'<div role="listitem" contenteditable></div>'),s.insertAdjacentHTML("beforeend",'<div role="listitem" contenteditable></div>'),n=i.children.length-1,this.#s(i.children[n]),s.children[n].className="selected";break;default:n<s.children.length&&(s.children[n].className="selected")}this.#i(),s.scrollTop=i.scrollTop}#s(e){e.focus();const t=document.getSelection(),i=document.createRange();i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i)}#i(){this.children[2].value=JSON.stringify([[...this.children[0].querySelectorAll("div")].map((e=>e.innerText.replaceAll("\n",""))).join(",").replace(/,+$/g,""),[...this.children[1].querySelectorAll("div")].map((e=>e.innerText.replaceAll("\n",""))).join(",").replace(/,+$/g,"")])}}customElements.define("kv-pair",kvPair);