async function kvImportData(e){if(!(e instanceof Element))return void document.querySelectorAll(".kvImportData[data-schema]").forEach((e=>kvImportData(e)));const t=document.createElement("a");t.href=e.dataset.schema;const r=await fetch(t.href,{mode:"no-cors"});if(r.ok?e.dataset.schema=await r.text():e.dataset.schema='{"error":{"name":"Schema error"}}',delete t,!e.dataset.schema)return;e.style.display="none";const a=document.createElement("table");function n(e){let t=[];e.currentTarget.querySelectorAll("tbody>tr").forEach((e=>{let r={};e.querySelectorAll("input").forEach((e=>r[e.name]=e.value)),t.push(r)})),e.currentTarget.previousSibling.value=JSON.stringify(t)}a.className="kvImportData",a.setAttribute("placeholder",e.getAttribute("placeholder")),a.kvRefCols=JSON.parse(e.dataset.schema),a.innerHTML=(()=>{let e="";return Object.values(a.kvRefCols).forEach((t=>e+=`<th>${t.name}</th>`)),`<caption><a href="#">${a.getAttribute("placeholder")}</a></caption><thead><tr>${e}</tr></thead>`})(),a.addEventListener("input",n),a.addEventListener("keydown",(e=>{if("INPUT"===e.target.tagName){const t=e.target.parentElement;switch(e.key){case"ArrowUp":t.parentElement.previousElementSibling?.children[t.cellIndex].firstChild.focus(),e.preventDefault();break;case"ArrowDown":t.parentElement.nextElementSibling?.children[t.cellIndex].firstChild.focus(),e.preventDefault()}}})),a.addEventListener("click",(async e=>{if("A"===e.target.tagName){const t=e.currentTarget,r=Object.keys(t.kvRefCols).length;try{t.querySelector("tbody")?.remove();let e=(await navigator.clipboard.readText()).replaceAll(/(\t)/gm,"</td><td>");e=e.replaceAll(/(\n)/gm,"</td></tr><tr><td>"),e=(e+"ยง").replace("<tr><td>ยง",""),t.insertAdjacentHTML("beforeend",`<tbody><tr><td>${e}</tbody>`),t.querySelectorAll("tbody>tr").forEach((e=>{if(e.children.length!=r)throw new RangeError("Invalid data");Object.values(t.kvRefCols).forEach(((r,a)=>{e.children[a].innerHTML=`<input form="kvRefTable" placeholder="${r.name}" name="${Object.keys(t.kvRefCols)[a]}" type="${r.type||""}" value="${function(e,t){if(!e||!e.match(/datetime|date|time/))return t;let r=t.match(l);if(r){for(let e in r.groups)r.groups[e]=parseInt(r.groups[e]);r=r.groups;let t=new Date(r.Y,r.M-1,r.D,r.h||null,r.m||null,r.s||null);switch(e){case"date":return t.toJSON().substring(0,10);case"time":return t.toJSON().substring(12,16);case"datetime":return t.toJSON().substring(0,16)}}return null}(r.type,e.children[a].innerText.trim())}">`}))})),n({currentTarget:t})}catch(e){t.querySelector("tbody").innerHTML=`<tr><td colspan="${r}"><strong>${e.toString()}</strong></td></tr>`,t.previousElementSibling.value="[]"}}})),e.insertAdjacentElement("afterend",a);const l={YMD:/(?<Y>\d{4})[-/. ](?<M>\d{1,2})[-/.](?<D>\d{1,2})(?:[ T](?<h>\d{2})\:(?<m>\d{2})(?:\:(?<s>\d{2}))?)?/,DMY:/(?<D>\d{1,2})[-/. ](?<M>\d{1,2})[-/.](?<Y>\d{4})(?:[ T](?<h>\d{2})\:(?<m>\d{2})(?:\:(?<s>\d{2}))?)?/,MDY:/(?<M>\d{1,2})[-/. ](?<D>\d{1,2})[-/.](?<Y>\d{4})(?:[ T](?<h>\d{2})\:(?<m>\d{2})(?:\:(?<s>\d{2}))?)?/}[(new Intl.DateTimeFormat).formatToParts().filter((e=>["year","month","day"].includes(e.type))).map((e=>e.type[0].toUpperCase())).join("")]||"YMD"}window.addEventListener("load",kvImportData);