async function kvTags(e){if(!(e instanceof Element))return void document.querySelectorAll("input[type=tags]").forEach((e=>kvTags(e)));let t=document.createElement("div");t.setAttribute("class","kvTags"),t.tags=e,e.insertAdjacentElement("afterend",t),t.appendChild(e),e.setAttribute("type","hidden");try{const t=new URL(e.getAttribute("accept")),n=await fetch(t),i=await n.text();e.predefinedTags=i.split(",")}catch{e.predefinedTags=e.getAttribute("accept").split(","),e.removeAttribute("accept")}let n=document.createElement("input");if(n.setAttribute("autocomplete","off"),n.style.width="inherit",n.addEventListener("change",(e=>{let t=e.target.value.replace(/([^àèéìùòça-z0-9-.]+)/gi,""),n=e.currentTarget.parentElement.parentElement.tags;if(t){let i=document.getElementById(`${n.name}_items`);-1==i.innerHTML.indexOf(`<li tabindex="0">${t}</li>`)&&(n.value+=(n.value?",":"")+t,i.innerHTML+=`<li tabindex="0">${t}</li>`),e.target.value=""}e.currentTarget.parentElement.previousElementSibling.dispatchEvent(new Event("input",{bubbles:!0}))})),n.setAttribute("list",e.getAttribute("list")),t.insertAdjacentHTML("beforeend",'<span style="white-space:nowrap"> ✚ </span>'),t.lastElementChild.insertAdjacentElement("afterbegin",n),!document.getElementById(n.getAttribute("list"))){let e=document.createElement("datalist");e.id=n.getAttribute("list");let i="";for(let e of t.tags.predefinedTags)i+=`<option value="${e}">${e}</option>`;e.innerHTML=i,t.appendChild(e)}let i=document.createElement("ul");i.id=t.tags.name+"_items",t.appendChild(i),options="";for(let e of t.tags.value.split(","))e&&(options+=`<li tabindex="0">${e}</li>`);function a(e){if("LI"===e.target.tagName&&(e.offsetX<2*parseInt(getComputedStyle(e.target).fontSize)||-1!="EscapeDelete".indexOf(e.key))){let t=e.currentTarget.parentElement.tags,n=e.target.innerText;t.value=t.value.replace(new RegExp(`(^${n},|,${n}(?=,)|,${n}$|^${n}$)`,"gi"),""),t.dispatchEvent(new Event("input",{bubbles:!0})),e.target.remove()}else e.target.focus({focusVisible:!0})}i.innerHTML=options,i.addEventListener("click",a),i.addEventListener("keyup",a)}window.addEventListener("load",kvTags);