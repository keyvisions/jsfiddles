async function kvTags(e){if(!(e instanceof Element))return void document.querySelectorAll("input[type=tags]").forEach((e=>kvTags(e)));let t=document.createElement("div");t.setAttribute("class","kvTags"),t.tags=e,e.insertAdjacentElement("afterend",t),t.appendChild(e),e.setAttribute("type","hidden");try{const t=new URL(e.getAttribute("accept")),n=await fetch(t),a=await n.text();e.predefinedTags=a.split(",")}catch{e.predefinedTags=e.getAttribute("accept").split(","),e.removeAttribute("accept")}let n=document.createElement("input");n.setAttribute("autocomplete","off"),n.addEventListener("change",(e=>{let t=e.target.value.replace(/([^àèéìùòça-z0-9-.]+)/gi,""),n=e.currentTarget.parentElement.parentElement.tags;if(t){if(n.predefinedTags.includes(t))document.getElementById(n.name).querySelector(`[value="${t}"]`).disabled=!0;else{if(!e.target.parentElement.previousElementSibling.hasAttribute("contenteditable"))return;n.predefinedTags.push(t),document.getElementById(n.name).innerHTML+=`<option value="${t}" disabled>${t}</option>`}let a=document.getElementById(`${n.name}_items`);-1==a.innerHTML.indexOf(`<li tabindex="0">${t}</li>`)&&(n.value+=(n.value?",":"")+t,a.innerHTML+=`<li tabindex="0">${t}</li>`),e.target.value=""}})),n.setAttribute("list",t.tags.name),t.insertAdjacentHTML("beforeend",'<span style="white-space:nowrap"> ✚</span>'),t.lastElementChild.insertAdjacentElement("afterbegin",n);let a=document.createElement("datalist");a.id=t.tags.name;let i="";for(let e of t.tags.predefinedTags)i+=`<option value="${e}">${e}</option>`;a.innerHTML=i,t.appendChild(a);let l=document.createElement("ul");l.id=t.tags.name+"_items",t.appendChild(l),i="";for(let e of t.tags.value.split(","))e&&(i+=`<li tabindex="0">${e}</li>`);function r(e){if("LI"===e.target.tagName&&(e.offsetX<2*parseInt(getComputedStyle(e.target).fontSize)||-1!="EscapeDelete".indexOf(e.key))){let t=e.currentTarget.parentElement.tags,n=e.target.innerText;t.value=t.value.replace(new RegExp(`(^${n},|,${n}(?=,)|,${n}$|^${n}$)`,"gi"),""),e.target.remove(),e.currentTarget.previousElementSibling.querySelector(`[value="${n}"]`).disabled=!1}else e.target.focus({focusVisible:!0})}l.innerHTML=i,l.addEventListener("click",r),l.addEventListener("keyup",r)}window.addEventListener("load",kvTags);